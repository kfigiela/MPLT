<html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

        <link href="css/styles.css" rel="stylesheet" media="screen">
        <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
        <link href="css/bootstrap-theme.min.css" rel="stylesheet" media="screen">

    </head>
    <body>
        <div class="editors-container">
            <div id="input-container" class="editor-container left">
                <div class="container-header">
                    <h3>AMPL input</h3>
                    <div class="input-navi">
                        <label>Auto refresh <input type="checkbox" id="refresh" value="false"></label>
                        <button id="send" class="btn btn-primary">Send</button>
                    </div>
                </div>
                <div id="editor-input" class="editor"></div>
            </div>
            <div id="output-container" class="editor-container right">
                <div class="container-header"><h3>LaTeX output</h3></div>
                <div id="editor-output" class="editor"></div>
            </div>
        </div>
        <div class="errors-container">
            <ul >
            </ul>
        </div>

        <script src="js/jquery-2.1.1.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="js/ace/ace.js" type="text/javascript" charset="utf-8"></script>
        <script type="text/javascript">
            var inputEditor = ace.edit("editor-input");
            inputEditor.setTheme("ace/theme/monokai");
            inputEditor.getSession().setMode("ace/mode/text");

            var outputEditor = ace.edit("editor-output");
            outputEditor.setTheme("ace/theme/monokai");
            outputEditor.getSession().setMode("ace/mode/tex");

            var setErrors = function(errors){
                var list = $(".errors-container ul" );
                list.empty();
                errors.forEach(function(error){
                    list.append('<li>' + error.split("<").join("&lt;").split(">").join("&gt;") + '</li>');
                });
            };

            var sendCode = function(){
                $.post("/", {text: inputEditor.getValue()} ,function(result){
                    outputEditor.setValue(result.text);
                    setErrors(result.errors);
                }, "json");
                return false;
            };

            $('#send').click(sendCode);

            var refresh = false;

            var refreshAction = function(){
                if(refresh){
                    sendCode();
                    setTimeout(refreshAction, 5000);
                }
            };

            $(":checkbox").change(function(){
                if(refresh === false){
                    refresh = true;
                    sendCode();
                    setTimeout(refreshAction, 5000);
                }else{
                    refresh = false;
                }
            });

        </script>
        <script src="js/bootstrap.min.js"></script>
    </body>
</html>